<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nmap Network Scan</title>
    <link rel="stylesheet" href="/static/dashboard.css" />
  </head>
  <body>
    <div class="dashboard">
      <!-- Sidebar -->
      <nav class="sidebar">
        <h2>Menu</h2>
        <ul>
          <li>
            <a href="{{ url_for('home') }}">Home</a>
          </li>
          <li>
            <a href="{{ url_for('scan_page') }}">Port Scan</a>
          </li>
          <li>
            <a href="{{ url_for('vscan_page') }}">Traffic Monitor</a>
          </li>
          <li>
            <a class="active" href="{{ url_for('file_scan') }}">File Scanner</a>
          </li>
          <li>
            <a href="{{ url_for('logout') }}">Logout</a>
          </li>
        </ul>
      </nav>

      <!-- Main Content -->
      <main class="content">
        <h1>Nmap Network Scan</h1>
        <div id="scanArea">
          <form id="nmapScanForm">
            <label for="target">Target (Localhost by default):</label>
            <input type="text" id="target" name="target" placeholder="127.0.0.1" />
            <button type="submit">Start Scan</button>
          </form>

          <!-- Spinner -->
          <div id="loadingSpinner" class="spinner" style="display: none;">
            <div class="lds-ring">
              <div></div>
              <div></div>
              <div></div>
              <div></div>
            </div>
            <p>Scanning... Please wait.</p>
          </div>

          <div id="scanResults" class="scan-output">
            <!-- Results will be injected here via JS -->
          </div>
        </div>
      </main>
    </div>

    <!--Script here-->
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("nmapScanForm");
  const results = document.getElementById("scanResults");
  const spinner = document.getElementById("loadingSpinner");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const target = document.getElementById("target").value || "127.0.0.1";

    spinner.style.display = "flex";
    results.innerHTML = "";

    try {
      const response = await fetch("/nmap-scan", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ target })
      });

      const data = await response.json();
      spinner.style.display = "none";

      if (data.success) {
        let html = `<h2>Scan Results</h2>`;
        data.results.forEach((host, i) => {
          html += `<h3>üîç Host ${i + 1}: ${host.host} (${host.status})</h3>`;
          host.protocols.forEach(proto => {
            html += `<h4>üì° Protocol: ${proto.protocol.toUpperCase()}</h4>`;
            html += `
              <table class="packet-table">
                <thead>
                  <tr><th>Port</th><th>State</th><th>Service</th></tr>
                </thead>
                <tbody>
            `;
            proto.ports.forEach(p => {
              html += `<tr>
                <td>${p.port}</td>
                <td>${p.state}</td>
                <td>${p.service}</td>
              </tr>`;
            });
            html += `</tbody></table>`;
          });
        });

        results.innerHTML = html;
      } else {
        results.innerHTML = `<p class="error">Error: ${data.error}</p>`;
      }
    } catch (err) {
      spinner.style.display = "none";
      results.innerHTML = `<p class="error">Request failed: ${err.message}</p>`;
    }
  });
});
</script>

  </body>
</html>
