<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nmap Network Scan</title>
    <link rel="stylesheet" href="/static/dashboard.css">
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <nav class="sidebar">
            <h2>Menu</h2>
            <ul>
                <li><a href="#">Dashboard</a></li>
                <li><a href="/scan">Port Scan</a></li>
                <li><a href="/trafficMonitor">traffic-Monitor</a></li>
                <li><a href="/logout">Logout</a></li>
            </ul>
        </nav>
    
        <!-- Main Content -->
        <main class="content">
            <h1>Nmap Network Scan</h1>
            <div id="scanArea">
                <form id="nmapScanForm">
                    <label for="target">Target (Localhost by default):</label>
                    <input type="text" id="target" name="target" placeholder="127.0.0.1">
                    <button type="submit">Start Scan</button>
                </form>
    
                <!-- Spinner -->
                <div id="loadingSpinner" class="spinner" style="display: none;">
                    <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
                    <p>Scanning... Please wait.</p>
                </div>
    
                <div id="scanResults">
                    <h2>Scan Results</h2>
                    <p>No results yet.</p>
                </div>
            </div>
        </main>
    </div>
    

    <script>
        document.getElementById('nmapScanForm').addEventListener('submit', async (e) => {
            e.preventDefault();
    
            const target = document.getElementById('target').value || '127.0.0.1';
            const resultsOutput = document.getElementById('scanResults');
            const spinner = document.getElementById('loadingSpinner'); // Spinner element
    
            try {
                //spinner loading 
                spinner.style.display = 'flex';
    
                const response = await fetch('/nmap-scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ target })
                });
    
                //remove spinner
                spinner.style.display = 'none';
    
                if (!response.ok) {
                    const errorData = await response.json();
                    resultsOutput.innerHTML = `<p class="error">Error: ${errorData.error}</p>`;
                    return;
                }
    
                const data = await response.json();
                if (data.success) {
                    const resultsHTML = generateResultsTable(data.results);
                    resultsOutput.innerHTML = resultsHTML;
                } else {
                    resultsOutput.innerHTML = `<p class="error">Error: ${data.error}</p>`;
                }
            } catch (error) {
                //error stament for spinner 
                spinner.style.display = 'none';
                resultsOutput.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        });
    
        function generateResultsTable(results) {
            let html = `
                <h2>Scan Results</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Host</th>
                            <th>Status</th>
                            <th>Protocol</th>
                            <th>Port</th>
                            <th>State</th>
                            <th>Service</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
    
            results.forEach(result => {
                result.protocols.forEach(protocol => {
                    protocol.ports.forEach(port => {
                        html += `
                            <tr>
                                <td>${result.host}</td>
                                <td>${result.status}</td>
                                <td>${protocol.protocol}</td>
                                <td>${port.port}</td>
                                <td>${port.state}</td>
                                <td>${port.service || 'N/A'}</td>
                            </tr>
                        `;
                    });
                });
            });
    
            html += `
                </tbody>
                </table>
            `;
            return html;
        }
    </script>
    
</body>
</html>
