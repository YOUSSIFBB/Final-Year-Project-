<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ThreatGuard - URL Scanner</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="dashboard">
    <div class="sidebar">
      <h2>Dashboard</h2>
      <ul>
        <li><a href="{{ url_for('home') }}">Home</a></li>
        <li><a href="{{ url_for('scan_page') }}">Port Scan</a></li>
        <li><a href="{{ url_for('vscan_page') }}">Traffic Monitor</a></li>
        <li><a href="{{ url_for('file_scan') }}">File Scanner</a></li>
        <li><a class="active" href="{{ url_for('url_scan') }}">URL Scanner</a></li>
        <li><a href="{{ url_for('logout') }}">Logout</a></li>
      </ul>
    </div>

    <div class="main-content">
      <div class="header">
        <h1>URL Scanner</h1>
      </div>

      <main>
        <form action="{{ url_for('url_scan') }}" method="POST" class="centered-form">
          <input type="url" name="url" placeholder="Enter URL to scan..." required>
          <button type="submit" class="btn">Scan URL</button>
        </form>

        {% if verdict %}
        <div class="results-summary">
          <h2>Verdict: 
            {% if verdict=='Safe' %}
              <span class="safe">‚úÖ Safe</span>
            {% elif verdict=='Malicious' %}
              <span class="danger">‚ùå Malicious</span>
            {% else %}
              <span class="warn">‚ö†Ô∏è {{ verdict }}</span>
            {% endif %}
          </h2>

          <h3>Statistics</h3>
          <table class="packet-table">
            <tr><th>Category</th><th>Count</th></tr>
            {% for cat, cnt in report['data']['attributes']['stats'].items() %}
            <tr><td>{{ cat.capitalize() }}</td><td>{{ cnt }}</td></tr>
            {% endfor %}
          </table>

          <h3>Engine Results</h3>
          <table class="packet-table">
            <tr><th>Engine</th><th>Category</th><th>Method</th><th>Result</th></tr>
            {% for engine, data in report['data']['attributes']['results'].items() %}
            <tr>
              <td>{{ engine }}</td>
              <td>{{ data.category }}</td>
              <td>{{ data.method }}</td>
              <td>{{ data.result }}</td>
            </tr>
            {% endfor %}
          </table>

          <h3>Full JSON</h3>
          <pre class="json-block">{{ report_json }}</pre>

          <form action="{{ url_for('download_url_report') }}" method="POST">
            <input type="hidden" name="scanned_url" value="{{ request.form.url }}">
            <input type="hidden" name="verdict" value="{{ verdict }}">
            <input type="hidden" name="report_json" value="{{ report_json|tojson }}">
            <button type="submit" class="btn">üìÑ Download PDF Report</button>
          </form>
        </div>
        {% endif %}

      </main>
    </div>
  </div>
</body>
</html>
